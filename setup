#!/bin/bash

set -e

[ "$DOTFILES_LOCATION" = "" ] && DOTFILES_LOCATION="$HOME/code"
[ "$DOTFILES_DIRNAME" = "" ] && DOTFILES_DIRNAME="dotfiles"

path="$DOTFILES_LOCATION/$DOTFILES_DIRNAME"

# set up wherever we're going to put the dotfiles
[ ! -d $DOTFILES_LOCATION ] && mkdir -p $DOTFILES_LOCATION

# clone dotfiles
if [ ! -d $path ]; then
  git clone git@github.com:wuputah/dotfiles.git $path
fi

# install main dotfiles from home/
shopt -s dotglob
for f in $path/home/*; do
  ln -nfs $f $HOME/$(basename $f)
done
shopt -u dotglob

# install .ssh/config separately since we dont want ssh keys in dotfiles
[ ! -d $HOME/.ssh ] && mkdir $HOME/.ssh
ln -nfs $path/ssh/config $HOME/.ssh/config

# pretend bash works like zsh even though it clearly does not
ln -nfs $HOME/.bashrc $HOME/.bash_profile

# did we symlink .gitconfig? undo!
[ -h $HOME/.gitconfig ] && rm $HOME/.gitconfig

# if .gitconfig is now missing, copy it and set up email address
if [ ! -e $HOME/.gitconfig ]; then
  cp $path/home/.gitconfig $HOME/.gitconfig
  git config --global user.$(echo ECDAB | tr ABCDE ilmae) $(echo CDAwuEutaBZORG | tr EABDCGROZ p@hdjmoc.)
fi
